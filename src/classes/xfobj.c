
/*
 *@@sourcefile xfobj.c:
 *      This file contains SOM code for the following XWorkplace classes:
 *
 *      --  XFldObject (WPObject replacement)
 *
 *      XFldObject gives the other classes access to WPS
 *      internals that cannot be reached otherwise. It
 *      also initializes the whole XWorkplace environment
 *      at WPS bootup by overriding M_XFldObject::wpclsInitData.
 *
 *      This class must always be installed.
 *
 *      Starting with V0.9.0, the files in classes\ contain only
 *      i.e. the methods themselves.
 *      The implementation for this class is mostly in filesys\object.c.
 *
 *@@somclass XFldObject xfobj_
 *@@somclass M_XFldObject xfobjM_
 */

/*
 *      Copyright (C) 1997-2000 Ulrich M”ller.
 *      This file is part of the XWorkplace source package.
 *      XWorkplace is free software; you can redistribute it and/or modify
 *      it under the terms of the GNU General Public License as published
 *      by the Free Software Foundation, in version 2 as it comes in the
 *      "COPYING" file of the XWorkplace main distribution.
 *      This program is distributed in the hope that it will be useful,
 *      but WITHOUT ANY WARRANTY; without even the implied warranty of
 *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *      GNU General Public License for more details.
 */

/*
 *@@todo:
 *
 */

/*
 *  This file was generated by the SOM Compiler and Emitter Framework.
 *  Generated using:
 *      SOM Emitter emitctm: 2.42
 */

#ifndef SOM_Module_xfobj_Source
#define SOM_Module_xfobj_Source
#endif
#define XFldObject_Class_Source
#define M_XFldObject_Class_Source

/*
 *  Suggested #include order:
 *  1)  os2.h
 *  2)  C library headers
 *  3)  setup.h (code generation and debugging options)
 *  4)  headers in helpers\
 *  5)  at least one SOM implementation header (*.ih)
 *  6)  dlgids.h, headers in shared\ (as needed)
 *  7)  headers in implementation dirs (e.g. filesys\, as needed)
 *  8)  #pragma hdrstop and then more SOM headers which crash with precompiled headers
 */

#define INCL_DOSPROCESS
#define INCL_DOSEXCEPTIONS
#define INCL_DOSSEMAPHORES
#define INCL_DOSERRORS
#define INCL_WINWINDOWMGR
#define INCL_WINMENUS
#define INCL_WINDIALOGS
#define INCL_WINSTDCNR
#define INCL_WINSTDBOOK
#include <os2.h>

// C library headers
#include <stdio.h>
#include <setjmp.h>             // needed for except.h
#include <assert.h>             // needed for except.h

// generic headers
#include "setup.h"                      // code generation and debugging options

// headers in /helpers
#include "helpers\cnrh.h"               // container helper routines
#include "helpers\except.h"             // exception handling
#include "helpers\winh.h"               // PM helper routines

// SOM headers which don't crash with prec. header files
#include "xfobj.ih"

// XWorkplace implementation headers
#include "dlgids.h"                     // all the IDs that are shared with NLS
#include "shared\common.h"              // the majestic XWorkplace include file
#include "shared\kernel.h"              // XWorkplace Kernel
#include "shared\wpsh.h"                // some pseudo-SOM functions (WPS helper routines)

#include "filesys\fileops.h"            // file operations implementation
#include "filesys\folder.h"             // XFolder implementation
#include "filesys\object.h"             // XFldObject implementation
#include "filesys\xthreads.h"           // extra XWorkplace threads

// other SOM headers
#pragma hdrstop
#include <wpfolder.h>                   // WPFolder

#include "helpers\undoc.h"              // some undocumented stuff

/* ******************************************************************
 *                                                                  *
 *   Global variables                                               *
 *                                                                  *
 ********************************************************************/

// "XFldObject" key for wpRestoreData etc.
const char* pcszXFldObject = "XFldObject";

// global variable whether XWorkplace is initialized yet
BOOL fXWorkplaceInitialized = FALSE;

/* ******************************************************************
 *                                                                  *
 *   here come the XFldObject instance methods                      *
 *                                                                  *
 ********************************************************************/

/*
 *@@ xwpAddObjectInternalsPage:
 *      this actually adds the "Internals" pages into all object notebooks,
 *      if the Global Settings allow it
 */

SOM_Scope ULONG  SOMLINK xfobj_xwpAddObjectInternalsPage(XFldObject *somSelf,
                                                            HWND hwndNotebook)
{
    PAGEINFO pi;
    const char* pszHelpLibrary = cmnQueryHelpLibrary();

    /* XFldObjectData *somThis = XFldObjectGetData(somSelf); */
    XFldObjectMethodDebug("XFldObject","xfobj_xwpAddObjectInternalsPages");

    // insert Shutdown settings page
    memset((PCH)&pi, 0, sizeof(PAGEINFO));
    pi.cb                  = sizeof(PAGEINFO);
    pi.hwndPage            = NULLHANDLE;
    pi.pfnwp               = obj_fnwpSettingsObjDetails;
    pi.resid               = cmnQueryNLSModuleHandle(FALSE);
    pi.pCreateParams       = somSelf;
                // passed to obj_fnwpSettingsObjDetails in mp2
    pi.dlgid               = ID_XSD_OBJECTDETAILS;
    pi.usPageStyleFlags    = BKA_STATUSTEXTON | BKA_MAJOR;   // major tab;
    pi.usPageInsertFlags   = BKA_FIRST;
    pi.usSettingsFlags     = 0; // don't enumerate in status line
    pi.pszName             = cmnQueryNLSStrings()->pszInternals;

    pi.pszHelpLibraryName  = (PSZ)pszHelpLibrary;
    pi.idDefaultHelpPanel  = ID_XSH_SETTINGS_OBJINTERNALS;

    return (_wpInsertSettingsPage(somSelf, hwndNotebook, &pi));
}

/*
 *@@ xwpQueryDeletion:
 *      if this object has been deleted into the XWorkplace trash can
 *      (that is, if the actual object currently resides in the hidden
 *      \TRASH directory tree and a related XWPTrashObject exists),
 *      this returns TRUE and puts the date and time of deletion into
 *      the specified structures.
 *
 *      If this object has not been deleted, FALSE is returned and the
 *      structures are not changed.
 *
 *      This method may be called at any time.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_xwpQueryDeletion(XFldObject *somSelf,
                                               CDATE* pcdateDeleted,
                                               CTIME* pctimeDeleted)
{
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    BOOL    brc = _fDeleted;

    XFldObjectMethodDebug("XFldObject","xfobj_xwpQueryDeletion");

    if (brc)
    {
        if (pcdateDeleted)
            memcpy(pcdateDeleted, &_cdateDeleted, sizeof(CDATE));
        if (pctimeDeleted)
            memcpy(pctimeDeleted, &_ctimeDeleted, sizeof(CTIME));
    }

    return (brc);
}

/*
 *@@ xwpSetDeletion:
 *      this sets the deletion date and time fields for this object.
 *      This method is only to be called by the XWorkplace trash can
 *      and changes the data which is subsequently returned by
 *      XFldObject::xwpQueryDeletion.
 *
 *      If (fSet == TRUE), the internal fields for deletion date and
 *      time will be set to the current system date and time, and
 *      subsequent calls to XFldObject::xwpQueryDeletion will return
 *      this data.
 *
 *      If (fSet == FALSE), subsequent calls to XFldObject::xwpQueryDeletion
 *      will return FALSE only.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_xwpSetDeletion(XFldObject *somSelf,
                                            BOOL fSet)
{
    // BOOL    brc = FALSE;
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_xwpSetDeletion");

    if (fSet)
    {
        // set deletion data:
        DATETIME    dt;
        DosGetDateTime(&dt);
        cnrhDateTimeDos2Win(&dt, &_cdateDeleted, &_ctimeDeleted);
        _fDeleted = TRUE;
    }
    else
        _fDeleted = FALSE;

    return (_wpSaveDeferred(somSelf));

    /* return (brc);
    if ((pcdateDeleted) && (pctimeDeleted))
    {
        memcpy(&_cdateDeleted, pcdateDeleted, sizeof(CDATE));
        memcpy(&_ctimeDeleted, pctimeDeleted, sizeof(CTIME));
        _fDeleted = TRUE;
        brc = TRUE;
        _wpSaveDeferred(somSelf);
    }

    return (brc); */
}

/*
 *@@ xwpSetTrashObject:
 *      sets the member trash object. This gets called
 *      by the trash can while somSelf is being deleted
 *      to the trash can or when the object has been
 *      previously deleted and the trash can is first
 *      populated after WPS bootup.
 *
 *      This reverse linkage makes sure we destroy the
 *      trash object when the related object (somSelf)
 *      gets deleted.
 *
 *@@added V0.9.2 (2000-03-15) [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_xwpSetTrashObject(XFldObject *somSelf,
                                                WPObject* pTrashObject)
{
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_xwpSetTrashObject");

    _pTrashObject = pTrashObject;

    return TRUE;
}

/*
 *@@ xwpQueryObjectHotkey:
 *      this returns the global object hotkey which has been defined
 *      to be monitored for in the XWorkplace hook.
 *
 *      If this object has been assigned a hotkey to, TRUE is returned,
 *      and the hotkey data is stored in the two USHORT variables.
 *
 *      *pusFlags contains the flags for the fsFlags parameter of
 *      the WM_CHAR message (SHORT1FROMMP(mp1)).
 *
 *      *pucScanCode contains the hardware scan code which is used
 *      to identify the hotkey in the XWorkplace hook. Since the
 *      char and virtual codes are not valid when a VIO session
 *      currently has the input focus, only the scan code can be
 *      used to identify keystrokes in the hook.
 *
 *      If *pusFlags has the KC_VIRTUALKEY flag set, *pusKeyCode has
 *      the usvk parameter of WM_CHAR; otherwise, it has the usch
 *      parameter (SHORT1/2FROMMP(mp2)). This will only be used to
 *      be able to describe the key on the dialogs, not to identify
 *      keystrokes in the XWorkplace hook.
 *
 *      If no hotkey has been assigned, FALSE is returned only.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_xwpQueryObjectHotkey(XFldObject *somSelf,
                                                   PUSHORT pusFlags,
                                                   PUCHAR pucScanCode,
                                                   PUSHORT pusKeyCode)
{
    XFldObjectMethodDebug("XFldObject","xfobj_xwpQueryObjectHotkey");
    return (objQueryObjectHotkey(somSelf, pusFlags, pucScanCode, pusKeyCode));
}

/*
 *@@ xwpSetObjectHotkey:
 *      this sets a new global object hotkey for the object.
 *      See XFldObject::xwpQueryObjectHotkey for the description
 *      of the hotkey parameters.
 *
 *      If the object was given a hotkey previously, the
 *      hotkey definition is overwritten.
 *
 *      If another object had the same object hotkey, the
 *      other object will lose its hotkey definition,
 *      because only each object must have a unique hotkey
 *      definition, if any.
 *
 *      As a special exception, if all three hotkey parameters
 *      are null, the hotkey for the object is removed from
 *      the internal hotkeys list (i.e. somSelf loses its
 *      hotkey).
 *
 *      The XWorkplace hook is automatically notified of the
 *      change, so that the new hotkey definition takes effect
 *      immediately.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_xwpSetObjectHotkey(XFldObject *somSelf,
                                                 USHORT usFlags,
                                                 UCHAR ucScanCode,
                                                 USHORT usKeyCode)
{
    XFldObjectMethodDebug("XFldObject","xfobj_xwpSetObjectHotkey");
    return (objSetObjectHotkey(somSelf, usFlags, ucScanCode, usKeyCode));
}

/*
 *@@ xwpQuerySetup:
 *      this new XFldObject method composes a setup string
 *      for the given object which contains all non-default
 *      settings for this object.
 *
 *      This method is the reverse to the wpSetup method.
 *      The settings string returned by this method can be
 *      passed to wpSetup (or WinSetObjectData) to restore
 *      the setting for this object. Unfortunately, IBM
 *      has never implemented a "query setup" method, so
 *      I did this now.
 *
 *      Since you can never be sure how long the setup string
 *      will be, you'll have to call this method twice:
 *
 *      1) On the first call, pass both pszSetupString and
 *         cbSetupString as NULL. The method will then
 *         return the length of the setup string for this
 *         object, _not_ including the terminating null byte.
 *
 *      2) Then, allocate a buffer of that size (+1 for the
 *         null-terminator) and call this method again with
 *         pszSetupString being that buffer and cbSetupString
 *         the size of that buffer (including the null byte).
 *
 *      This method only returns setup strings which have
 *      non-default values.
 *
 *      This method calls XFldObject::xwpQuerySetup2, using
 *      SOM name-lookup resolution, to allow for additional
 *      implementations in subclasses. See remarks there.
 *
 *@@added V0.9.1 (2000-01-16) [umoeller]
 */

SOM_Scope ULONG  SOMLINK xfobj_xwpQuerySetup(XFldObject *somSelf,
                                             PSZ pszSetupString,
                                             ULONG cbSetupString)
{
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_xwpQuerySetup");

    TRY_LOUD(excpt1, NULL)
    {
        // obtain "xwpQuerySetup2" method pointer
        somTD_XFldObject_xwpQuerySetup2 pfn_xwpQuerySetup2 = 0;

        pfn_xwpQuerySetup2 = (somTD_XFldObject_xwpQuerySetup2)somResolveByName(somSelf,
                                                                               "xwpQuerySetup2");
        if (pfn_xwpQuerySetup2)
            return (pfn_xwpQuerySetup2(somSelf, pszSetupString, cbSetupString));
    }
    CATCH(excpt1)
    {
    } END_CATCH();

    return (0);
}

/*
 *@@ xwpQuerySetup2:
 *      this is the implementation for querying setup strings
 *      which gets called by XFldObject::xwpQuerySetup.
 *
 *      This has been placed into a separate method because this
 *      method needs to be called using SOM name-lookup
 *      resolution to support overriding it in subclasses
 *      of XFldObject (WPObject), which xwpQuerySetup does.
 *
 *      Never call this method directly. This has only been
 *      separated to allow for easier overriding in subclasses.
 *      Instead, call XFldObject::xwpQuerySetup.
 *
 *      If you wish to override this method for subclasses,
 *      you must call the XFldObject implementation of this
 *      method.
 *
 *      Note that you cannot simply use _parent_xwpQuerySetup
 *      to call the parent method, because there's no C binding
 *      for this. The SOM header files do not know that WPObject
 *      has been replaced with XFldObject and therefore have no
 *      idea that XFldObject is actually a parent class of all
 *      other WPS classes.
 *      So to call this parent method, use the following code:
 *
 +          // resolve method for XFldObject
 +          somTD_XFldObject_xwpQuerySetup pfn_xwpQuerySetup2
 +              = SOM_Resolve(somSelf,
 +                            XFldObject,   // "token" for introducing class
 +                            xwpQuerySetup2); // "token" for method name
 +          // now call that method
 +          if (pfn_xwpQuerySetup2)
 +              ulReturn = pfn_xwpQuerySetup2(somSelf, pszSetupString, cbSetupString);
 *
 *      Important note: You must call the XFldObject method
 *      _after_ your implementation, because the OBJECTID
 *      setup string must be added at the very last position
 *      in the complete setup string, and that string is implemented
 *      by the XFldObject method.
 *
 *      See XFolder::xwpQuerySetup2 for a sample implementation
 *      which adds setup strings for a subclass of XFldObject.
 *
 *@@added V0.9.1 (2000-01-17) [umoeller]
 */

SOM_Scope ULONG  SOMLINK xfobj_xwpQuerySetup2(XFldObject *somSelf,
                                              PSZ pszSetupString,
                                              ULONG cbSetupString)
{
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_xwpQuerySetup2");

    return (objQuerySetup(somSelf,
                          pszSetupString,
                          cbSetupString));
}

/*
 *@@ wpInitData:
 *      this instance method gets called when the object
 *      is being initialized. We initialize our instance
 *      data here.
 *
 *@@added V0.9.0 [umoeller]
 *@@changed V0.9.2 (2000-03-15) [umoeller]: initializing new members
 */

SOM_Scope void  SOMLINK xfobj_wpInitData(XFldObject *somSelf)
{
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpInitData");

    XFldObject_parent_WPObject_wpInitData(somSelf);

    _fDeleted = FALSE;
    _pWPObjectData = NULL;
    _cbWPObjectData = 0;

    _pWPObjectData = NULL;
    _cbWPObjectData = 0;

    _pTrashObject = NULL;
}

/*
 *@@ wpObjectReady:
 *      this is called upon an object when its creation
 *      or awakening is complete. This is the last method
 *      which gets called during instantiation of a
 *      WPS object when it has completely initialized
 *      itself. ulCode signifies the cause of object
 *      instantiation.
 *
 *      We will have this object's pointer stored
 *      in a global list (maintained by the Worker thread)
 *      so that XShutdown knows which objects are currently
 *      awake.
 *
 *      Note: On my Warp 4 (FP 10), this method does _not_
 *      get called for WPFolder instances, so we override
 *      XFolder::wpObjectReady also.
 *
 *@@changed V0.9.0: adjust for XFolder: [umoeller]:wpObjectReady override
 */

SOM_Scope void  SOMLINK xfobj_wpObjectReady(XFldObject *somSelf,
                                              ULONG ulCode, WPObject* refObject)
{
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    // XFldObjectMethodDebug("XFldObject","xfobj_wpObjectReady");

    #if defined(DEBUG_SOMMETHODS) || defined(DEBUG_AWAKEOBJECTS)
        _Pmpf(("xfobj_wpObjectReady for %s (class %s), ulCode: %s",
                _wpQueryTitle(somSelf),
                _somGetName(_somGetClass(somSelf)),
                (ulCode == OR_AWAKE) ? "OR_AWAKE"
                : (ulCode == OR_FROMTEMPLATE) ? "OR_FROMTEMPLATE"
                : (ulCode == OR_FROMCOPY) ? "OR_FROMCOPY"
                : (ulCode == OR_NEW) ? "OR_NEW"
                : (ulCode == OR_SHADOW) ? "OR_SHADOW"
                : (ulCode == OR_REFERENCE) ? "OR_REFERENCE"
                : "unknown code"
             ));
    #endif

    XFldObject_parent_WPObject_wpObjectReady(somSelf, ulCode,
                                             refObject);

    // on my Warp 4 FP 10, this method does not get
    // called for WPFolder instances, so we override
    // WPFolder::wpObjectReady also; but we don't know
    // if this is so with all Warp versions, so we
    // better check
    if (!_somIsA(somSelf, _WPFolder))
        xthrPostWorkerMsg(WOM_ADDAWAKEOBJECT,
                         (MPARAM)somSelf,
                         MPNULL);
}

/*
 *@@ wpUnInitData:
 *      reverse to XFldObject::wpObjectReady, this instance
 *      method is called by the system when an object is made
 *      dormant. We will have this object removed from our
 *      global list of awake objects.
 */

SOM_Scope void  SOMLINK xfobj_wpUnInitData(XFldObject *somSelf)
{
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpUnInitData");

    // if (_fAddedToAwakeList)
        xthrPostWorkerMsg(WOM_REMOVEAWAKEOBJECT,
                         (MPARAM)somSelf,
                         MPNULL);

    XFldObject_parent_WPObject_wpUnInitData(somSelf);
}

/*
 *@@ wpSaveState:
 *      this instance method is called to allow an
 *      an object to save its state; XFldObject will
 *      save the deletion data here.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_wpSaveState(XFldObject *somSelf)
{
    BOOL    brc = FALSE;
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpSaveState");

    brc = XFldObject_parent_WPObject_wpSaveState(somSelf);

    if (_fDeleted)
    {
        // save deletion data:
        _wpSaveData(somSelf, (PSZ)pcszXFldObject, 1,
                    (PBYTE)&_cdateDeleted, sizeof(CDATE));
        _wpSaveData(somSelf, (PSZ)pcszXFldObject, 2,
                    (PBYTE)&_ctimeDeleted, sizeof(CTIME));
    }

    return (brc);
}

/*
 *@@ wpRestoreState:
 *      this instance method is called to allow an
 *      an object to restore its state; XFldObject will
 *      restore the deletion data here.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_wpRestoreState(XFldObject *somSelf,
                                             ULONG ulReserved)
{
    BOOL    brc = FALSE;
    ULONG   cbcdate = sizeof(CDATE),
            cbctime = sizeof(CTIME);
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpRestoreState");

    brc = XFldObject_parent_WPObject_wpRestoreState(somSelf,
                                                    ulReserved);

    if (    (_wpRestoreData(somSelf, (PSZ)pcszXFldObject, 1,
                            (PBYTE)&_cdateDeleted, &cbcdate))
         && (_wpRestoreData(somSelf, (PSZ)pcszXFldObject, 2,
                            (PBYTE)&_ctimeDeleted, &cbctime))
       )
        // both keys successfully restored:
        _fDeleted = TRUE;
    else
        _fDeleted = FALSE;
    return (brc);
}

/*
 *@@ wpRestoreData:
 *      this instance method restores a 32-bit data
 *      value for the object data upon object awakening.
 *
 *      We check the "ulKey" value after having called
 *      the parent to be able to intercept the pointer
 *      to certain WPS-internal object data, which
 *      we cannot access otherwise. That's a real ugly
 *      kludge, but there's no other way to get certain
 *      object settings. ;-)
 *
 *      It is possible to override this method for WPObject
 *      even though WPObject does not define the implementation
 *      how object data is stored and restored. This works
 *      because the implementation apparently sits in
 *      wpRestoreState, which is overridden by the WPS
 *      base storage classes (WPAbstract, WPTransient,
 *      WPFileSystem). This method is _not_ overridden.
 *
 *@@added V0.9.1 (2000-01-22) [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobj_wpRestoreData(XFldObject *somSelf,
                                            PSZ pszClass, ULONG ulKey,
                                            PBYTE pValue, PULONG pcbValue)
{
    BOOL    brc = FALSE;
    XFldObjectMethodDebug("XFldObject","xfobj_wpRestoreData");

    brc = XFldObject_parent_WPObject_wpRestoreData(somSelf,
                                                   pszClass,
                                                   ulKey, pValue,
                                                   pcbValue);

    if ( (brc) && (pValue) )
    {
        switch (ulKey)
        {
            case 11:        // IDKEY_OBJDATA, not defined
            {
                XFldObjectData *somThis = XFldObjectGetData(somSelf);
                _pWPObjectData = (PVOID)pValue;
                _cbWPObjectData = *pcbValue;
            break; }
        }
    }

    return (brc);
}

/*
 *@@ wpDisplayMenu:
 *      this WPObject instance method creates and displays
 *      an object's popup menu, which is returned.
 *
 *      From my testing (after overriding _all_ WPDataFile methods...),
 *      I found out that wpDisplayMenu calls the following methods
 *      in this order:
 *
 *      --  wpFilterMenu (Warp-4-specific);
 *      --  wpFilterPopupMenu;
 *      --  wpModifyPopupMenu;
 *      --  wpModifyMenu (Warp-4-specific).
 *
 *      Normally, this method does not need to be overridden
 *      to modify menus. HOWEVER, with Warp 4, IBM was kind
 *      enough to ignore all changes to the list of associated
 *      programs added to the "Open" submenu, because most
 *      apparently, Warp 4 no longer adds the programs in
 *      the wpModifyPopupMenu method, but in the Warp-4-specific
 *      wpModifyMenu method, which is called too late for me.
 *
 *      Unfortunately, it is thus impossible to prevent the WPS
 *      from adding program objects to the "Open" submenu, except
 *      for overriding this method and removing them all again, or
 *      breaking compatibility with Warp 3. Duh.
 *
 *@@added V0.9.0 [umoeller]
 */

SOM_Scope HWND  SOMLINK xfobj_wpDisplayMenu(XFldObject *somSelf,
                                            HWND hwndOwner, HWND hwndClient,
                                            POINTL* ptlPopupPt,
                                            ULONG ulMenuType,
                                            ULONG ulReserved)
{
    HWND    hwndMenu = NULLHANDLE;
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    // XFldObjectMethodDebug("XFldObject","xfobj_wpDisplayMenu");

    #if defined DEBUG_MENUS || defined DEBUG_SOMMETHODS
        _Pmpf(("wpDisplayMenu for %s, ulMenuType: 0x%lX (%d)",
                _wpQueryTitle(somSelf), ulMenuType, ulMenuType));
    #endif

    hwndMenu = XFldObject_parent_WPObject_wpDisplayMenu(somSelf,
                                                        hwndOwner,
                                                        hwndClient,
                                                        ptlPopupPt,
                                                        ulMenuType,
                                                        ulReserved);

    return (hwndMenu);
}

/*
 *@@ wpFilterPopupMenu:
 *      remove default entries according to global settings.
 */

SOM_Scope ULONG  SOMLINK xfobj_wpFilterPopupMenu(XFldObject *somSelf,
                                                   ULONG ulFlags,
                                                   HWND hwndCnr,
                                                   BOOL fMultiSelect)
{
    ULONG ulMenuFilter = 0;
    PCGLOBALSETTINGS pGlobalSettings = cmnQueryGlobalSettings();
    XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpFilterPopupMenu");

    ulMenuFilter = XFldObject_parent_WPObject_wpFilterPopupMenu(somSelf,
                                                         ulFlags,
                                                         hwndCnr,
                                                         fMultiSelect);
    #ifdef DEBUG_MENUS
        _Pmpf(("XFldObject::wpFilterPopupMenu: ulMenuFilter & CTXT_CRANOTHER: 0x%lX %d",
                ulMenuFilter, ((ulMenuFilter) & CTXT_CRANOTHER)));
    #endif

    // if object has been deleted already (ie. is in trashcan),
    // remove delete
    if (_fDeleted)
        ulMenuFilter &~ CTXT_DELETE;

    // now suppress default menu items according to
    // Global Settings;
    // the DefaultMenuItems field in pGlobalSettings is
    // ready-made for this function; the "Workplace Shell"
    // notebook page for removing menu items sets this field with
    // the proper CTXT_xxx flags
    return ((ulMenuFilter
            // first we add "Create another", because for
            // some reason it's always disabled if XFolder
            // is installed; I don't know why
            | CTXT_CRANOTHER )
            // then disable items, this may include CTXT_CRANOTHER
            & ~(pGlobalSettings->DefaultMenuItems)
        );
}

/*
 *@@ wpModifyPopupMenu:
 *      add my own popup menu entries.
 */

SOM_Scope BOOL  SOMLINK xfobj_wpModifyPopupMenu(XFldObject *somSelf,
                                                  HWND hwndMenu,
                                                  HWND hwndCnr,
                                                  ULONG iPosition)
{
    BOOL        rc;
    PCGLOBALSETTINGS pGlobalSettings = cmnQueryGlobalSettings();
    // PNLSSTRINGS pNLSStrings = cmnQueryNLSStrings();
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpModifyPopupMenu");

    rc = (XFldObject_parent_WPObject_wpModifyPopupMenu(somSelf,
                                                         hwndMenu,
                                                         hwndCnr,
                                                         iPosition));
    if (pGlobalSettings->RemoveLockInPlaceItem)
        // remove WPObject's "Lock in place" submenu
        winhDeleteMenuItem(hwndMenu, ID_WPM_LOCKINPLACE);

    // now that the menu is completely built, let's add hotkey
    // descriptions, but DONT do this for folders or data files,
    // because those menu items will only be added later... for
    // folders, we call this function in XFolder::wpMenuItemSelected
    if (!_somIsA(somSelf, _WPFileSystem))
        fdrAddHotkeysToMenu(somSelf,
                            hwndCnr,
                            hwndMenu);

    return rc;
}

/*
 *@@ wpMenuItemSelected:
 *      this WPObject method processes menu selections.
 *      This is overridden to support the new menu items
 *      we have inserted for our subclass.
 *
 *      Note that the WPS invokes this method upon every
 *      object which has been selected in the container.
 *      That is, if three objects have been selected and
 *      a menu item has been selected for all three of
 *      them, all three objects will receive this method
 *      call. This is true even if FALSE is returned from
 *      this method.
 */

/*
 * wpAddSettingsPages: override;
 */

SOM_Scope BOOL  SOMLINK xfobj_wpMenuItemSelected(XFldObject *somSelf,
                                                 HWND hwndFrame,
                                                 ULONG ulMenuId)
{
    BOOL                brc = FALSE;

    // PGLOBALSETTINGS     pGlobalSettings = cmnQueryGlobalSettings();
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpMenuItemSelected");

    switch (ulMenuId)
    {
        #ifdef DEBUG_CONTEXT
            case ID_XFMI_RECORDCORE:
            {
                int                 i;
                CHAR                szMsg[1024] = "No record core.",
                                    szTitle[1024],
                                    szBuf[20] = "0x00000000";
                PMINIRECORDCORE     pMRC = _wpQueryCoreRecord(somSelf);
                PCLASSFIELDINFO     pCFI, pCFI2;
                ULONG               ulCFISize = 0, ulErr;

                strcpy(szTitle, "Record core for ");
                strcat(szTitle, _wpQueryTitle(somSelf));

                strcpy(szMsg, "Size of core record (cb): ");
                UL2H(szBuf+2, pMRC->cb);
                strcat(szMsg, szBuf);

                strcat(szMsg, "\nSize of MINIRECORDCORE:   ");
                UL2H(szBuf+2, sizeof(MINIRECORDCORE));
                strcat(szMsg, szBuf);

                strcat(szMsg, "\nSize of RECORDCORE:       ");
                UL2H(szBuf+2, sizeof(RECORDCORE));
                strcat(szMsg, szBuf);

                strcat(szMsg, "\nNext record:              ");
                UL2H(szBuf+2, (ULONG)pMRC->preccNextRecord);
                strcat(szMsg, szBuf);

                strcat(szMsg, "\nIcon X pos:               ");
                UL2H(szBuf+2, pMRC->ptlIcon.x);
                strcat(szMsg, szBuf);

                strcat(szMsg, "\nIcon Y pos:               ");
                UL2H(szBuf+2, pMRC->ptlIcon.y);
                strcat(szMsg, szBuf);

                strcat(szMsg, "\n\nDetails CLASSFIELDINFO:");

                strcat(szMsg, "\nSize of structure:        ");
                _wpQueryDetailsData(somSelf, NULL, &ulCFISize);
                UL2H(szBuf+2, ulCFISize);
                strcat(szMsg, szBuf);

                pCFI = (PCLASSFIELDINFO)_wpAllocMem(somSelf, ulCFISize, &ulErr);
                pCFI2 = pCFI;
                _wpQueryDetailsData(somSelf, (PVOID)&pCFI2, &ulCFISize);

                _wpFreeMem(somSelf, (PVOID)pCFI);

                DebugBox(szTitle, szMsg);

                brc = TRUE;
            break; }

            case ID_XFMI_SHOWFOLDERDATA:
            {
                xthrPostWorkerMsg(WM_SHOWFOLDERDATA,
                                  (MPARAM)somSelf,
                                  MPNULL);
                brc = TRUE;
            break; }
        #endif

        case WPMENUID_DELETE:
            /* _Pmpf(("Deleting object %s, hwndFrame: 0x%lX",
                   _wpQueryTitle(somSelf),
                   hwndFrame )); */
            brc = XFldObject_parent_WPObject_wpMenuItemSelected(somSelf,
                                                                hwndFrame,
                                                                ulMenuId);
        break;

        default:
            brc = XFldObject_parent_WPObject_wpMenuItemSelected(somSelf,
                                                                hwndFrame,
                                                                ulMenuId);
    }

    return (brc);
}

/*
 *@@ wpAddSettingsPages:
 *      this instance method inserts all the settings
 *      pages into an object's settings notebook.
 *      We will add the object's "Internals" page here.
 */

/* SOM_Scope BOOL  SOMLINK xfobj_wpAddSettingsPages(XFldObject *somSelf,
                                                 HWND hwndNotebook)
{
    PCGLOBALSETTINGS     pGlobalSettings = cmnQueryGlobalSettings();
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpAddSettingsPages");

    return (XFldObject_parent_WPObject_wpAddSettingsPages(somSelf,
                                                          hwndNotebook));
} */

/*
 *@@ wpAddObjectGeneralPage:
 *      this WPObject instance method adds the "Icon"
 *      page to an object's settings notebook.
 *      We'll insert the object's "Internals" page here
 *      (now called "Object" page).
 *
 *      Starting with V0.9.1, we override this method
 *      instead of wpAddSettingsPages, because e.g.
 *      the spooler doesn't call WPObject::wpAddSettingsPages.
 *
 *      Starting with V0.9.2, we add the page for all
 *      objects except folders, where XFolder::wpAddObjectGeneralPage2
 *      will do the job.
 *
 *@@added V0.9.1 (2000-02-17) [umoeller]
 */

SOM_Scope ULONG  SOMLINK xfobj_wpAddObjectGeneralPage(XFldObject *somSelf,
                                                      HWND hwndNotebook)
{
    PCGLOBALSETTINGS     pGlobalSettings = cmnQueryGlobalSettings();
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpAddObjectGeneralPage");

    if (pGlobalSettings->AddObjectPage)
        // check if this is a folder;
        // if so, XFolder will insert the page
        // because otherwise this would be between
        // the two "Icon" pages...
        if (!_somIsA(somSelf, _WPFolder))
            _xwpAddObjectInternalsPage(somSelf, hwndNotebook);

    return (XFldObject_parent_WPObject_wpAddObjectGeneralPage(somSelf,
                                                              hwndNotebook));
}

/*
 *@@ wpConfirmObjectTitle:
 *      this instance method is called by the WPS during file
 *      operations (copy, move, rename etc.) for every single
 *      object that is being processed. This method must verify
 *      that the operation is valid WRT name clashes and display
 *      a confirmation dialog in case it is not.
 *
 *      Apparently, this method is not overridden by subclasses,
 *      not even WPFileSystem.
 *
 *      XWorkplace implements its own "Object exists" dialog here,
 *      if the Global Settings allow it.
 *
 *      Like most interesting methods in the WPS, this thing is
 *      barely documented, so this is what I found out.
 *
 *      Parameters:
 *      -- *somSelf      in: the object being worked on
 *      -- *Folder       in: the folder being worked on
 *      -- **ppDuplicate out: if we return NAMECLASH_REPLACE,
 *                            we need to set this to the object to
 *                            be replaced
 *      -- pszTitle      in: title of somSelf
 *                            out: if we return NAMECLASH_RENAME,
 *                            we need to set this to somSelf's new title
 *      -- cbTitle       in: sizeof(*pszTitle)
 *      -- menuID        in: the user's operation, which is:
 *                              0x0065    create another (WPMENUID_CREATEANOTHER)
 *                              0x006B    move (WPMENUID_MOVE)
 *                              0x006C    copy (WPMENUID_COPY)
 *                              0x006E    rename (no menu ID defined in wpobject.h)
 *                              0x013C    create shadow (WPMENUID_CREATESHADOW)
 *
 *      Returns:
 *      -- NAMECLASH_CANCEL (0):
 *                  abort processing, have the WPS do nothing ("Cancel"
 *                  button pressed in confirmation dialog); this will
 *                  just skip the current file;
 *      -- NAMECLASH_NONE (1):
 *                  continue processing, but perform no further
 *                  renaming etc.; we return this if no duplicate file
 *                  exists;
 *      -- NAMECLASH_RENAME (2):
 *                  have the WPS change the title to pszTitle, which we
 *                  need to set here; note that this does NOT change
 *                  the real name! So we do the renaming ourselves here;
 *      -- NAMECLASH_REPLACE (8):
 *                  have the WPS delete *ppDuplicate, which we need to
 *                  set here if we return this code; we need to find the
 *                  duplicate in this method then.
 *
 *      Note: these constants are only defined in the Warp 4 Toolkit
 *      (some of them in wpsystem.h in Warp 3 Toolkit also). So
 *      #include helpers/undoc.h, which defines these.
 *
 *@@changed V0.9.0 [umoeller]: fixed "create another" bug
 */

SOM_Scope ULONG  SOMLINK xfobj_wpConfirmObjectTitle(XFldObject *somSelf,
                                                    WPFolder* Folder,
                                                    WPObject** ppDuplicate,
                                                    PSZ pszTitle,
                                                    ULONG cbTitle,
                                                    ULONG menuID)
{
    ULONG ulrc = NAMECLASH_NONE;

    PCGLOBALSETTINGS pGlobalSettings = cmnQueryGlobalSettings();

    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpConfirmObjectTitle");

    #ifdef DEBUG_TITLECLASH
    {
        CHAR szFolder2[CCHMAXPATH];
        _Pmpf(("Entering wpConfirmObjectTitle"));
        _Pmpf(("  somSelf == 0x%lX", somSelf));
        _Pmpf(("    pszTitle: %s", pszTitle));
        _wpQueryFilename(_wpQueryFolder(somSelf), szFolder2, TRUE);
        _Pmpf(("    in folder: %s", szFolder2));
        _Pmpf(("  menuID: 0x%lX", menuID));
    }
    #endif

    // first of all, check whether the confirmation
    // dialogs have been replaced in the global settings;
    if (pGlobalSettings->fReplFileExists)
    {
        // yes: use our replacement (fileops.c)
        ulrc = fopsConfirmObjectTitle(somSelf,
                                      Folder,
                                      ppDuplicate,
                                      pszTitle,
                                      cbTitle,
                                      menuID);
    }
    else
    {
        // global settings do not allow dialog
        // replacement: call default
        #ifdef DEBUG_TITLECLASH
            _Pmpf(("  Calling original"));
        #endif
        ulrc = XFldObject_parent_WPObject_wpConfirmObjectTitle(somSelf,
                                                               Folder,
                                                               ppDuplicate,
                                                               pszTitle,
                                                               cbTitle,
                                                               menuID);
    }

    #ifdef DEBUG_TITLECLASH
    {
        CHAR szFolder2[CCHMAXPATH];
        _Pmpf(("  Return value: %d", ulrc));
        _Pmpf(("  New somSelf == 0x%lX", somSelf));
        _Pmpf(("    New pszTitle: %s", pszTitle));
        _wpQueryFilename(_wpQueryFolder(somSelf), szFolder2, TRUE);
        _Pmpf(("    in folder: %s", szFolder2));

        if (ppDuplicate) {
            _Pmpf(("  ppDuplicate neu != NULL"));
            if (*ppDuplicate) {
                _Pmpf(("    *ppDuplicate neu == 0x%lX", *ppDuplicate));
                _Pmpf(("      Title neu: %s", _wpQueryTitle(*ppDuplicate) ));
                _wpQueryFilename(_wpQueryFolder(*ppDuplicate), szFolder2, TRUE);
                _Pmpf(("      in folder: %s", szFolder2));
            }
        }
        _Pmpf(("Done."));
    }
    #endif

    return (ulrc);
}

/*
 *@@ wpDelete:
 *      this WPObject method deletes an object and
 *      prompts for confirmations, if necessary.
 *
 *      We override this to move objects into the
 *      trash can instead, if necessary.
 *
 *@@added V0.9.1 (2000-01-25) [umoeller]
 */

SOM_Scope ULONG  SOMLINK xfobj_wpDelete(XFldObject *somSelf,
                                        ULONG fConfirmations)
{
    // XFldObjectData *somThis = XFldObjectGetData(somSelf);
    XFldObjectMethodDebug("XFldObject","xfobj_wpDelete");

    return (XFldObject_parent_WPObject_wpDelete(somSelf, fConfirmations));
}

/* ******************************************************************
 *                                                                  *
 *   here come the XFldObject class methods                         *
 *                                                                  *
 ********************************************************************/

/*
 * @@ xwpclsRemoveObjectHotkey:
 *            this removes the object hotkey for the
 *            given object. This extra function is
 *            necessary because if an object handle
 *            for an object with a hotkey gets lost
 *            (e.g. because the object was deleted),
 *            there's no way to invoke XFldObject::xwpSetObjectHotkey
 *            on it.
 *
 *            @@added V0.9.0 (99-11-12) [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobjM_xwpclsRemoveObjectHotkey(M_XFldObject *somSelf,
                                                        HOBJECT hobj)
{
    /* M_XFldObjectData *somThis = M_XFldObjectGetData(somSelf); */
    M_XFldObjectMethodDebug("M_XFldObject","xfobjM_xwpclsRemoveObjectHotkey");

    return (objRemoveObjectHotkey(hobj));
}

/*
 *@@ wpclsInitData:
 *      we override this to initialize XWorkplace altogether.
 *
 *      This is probably the first WPS method called on the
 *      system (for M_WPObject, that is), so we use this
 *      to set up some stuff, most notably, start the
 *      additional XWorkplace threads by calling
 *      krnInitializeXWorkplace, which handles the details.
 *
 *      The beautiful thing is that at this point we appear
 *      to own the computer all alone. It seems that no
 *      additional WPS threads are running _yet_ (or if they
 *      are, they don't care), so we can halt the system,
 *      display graphics, overwrite the master boot record,
 *      whatever. (JUST KIDDING.)
 *
 *@@changed V0.9.0 [umoeller]: added class object to KERNELGLOBALS
 */

SOM_Scope void  SOMLINK xfobjM_wpclsInitData(M_XFldObject *somSelf)
{
    BOOL    fOpenFoldersFound = FALSE;
    PCGLOBALSETTINGS pGlobalSettings = cmnQueryGlobalSettings();
                        // this will load the global settings from OS2.INI

    // M_XFldObjectData *somThis = M_XFldObjectGetData(somSelf);
    // M_XFldObjectMethodDebug("M_XFldObject","xfobjM_wpclsInitData");
    #ifdef DEBUG_SOMMETHODS
        _Pmpf(("M_XFldObject::xfobjM_wpclsInitData for class %s",
                    _somGetName(somSelf) ));
    #endif

    M_XFldObject_parent_M_WPObject_wpclsInitData(somSelf);

    // since this code is reached for every single WPS class
    // that gets initialized, we need to check if we're being
    // called for the first time
    if (!fXWorkplaceInitialized)
    {
        // check if we have any open folder windows;
        // if so, we're not really in the process of starting
        // up. This check is necessary because this class
        // method also gets called when the classes are installed
        // by WinRegisterObjectClass, unfortunately, and we don't
        // want to start threads etc. then.
        HENUM   henum = WinBeginEnumWindows(HWND_DESKTOP);
        HWND    hwndThis;
        while (     (!fOpenFoldersFound)
                 && (hwndThis = WinGetNextWindow(henum))
              )
        {
            CHAR    szClass[200];
            if (WinQueryClassName(hwndThis, sizeof(szClass), szClass))
                if (strcmp(szClass, "wpFolder window") == 0)
                    // folder window:
                    fOpenFoldersFound = TRUE;
        }
        WinEndEnumWindows(henum);

        fXWorkplaceInitialized = TRUE;

        if (!fOpenFoldersFound)
            // only if no open folders are found:
            // initialize the kernel (kernel.c)
            krnInitializeXWorkplace();

        {
            PKERNELGLOBALS   pKernelGlobals = krnLockGlobals(5000);
            // store the XFldObject class object in KERNELGLOBALS
            pKernelGlobals->fXFldObject = TRUE;
            krnUnlockGlobals();
        }
    }

    if (!fOpenFoldersFound)
        // even if not first invocation (i.e. some class other
        // than WPObject gets initialized): notify Speedy thread
        // of class initialization
        if (pGlobalSettings->ShowBootupStatus)
            xthrPostSpeedyMsg(QM_BOOTUPSTATUS,
                             (MPARAM)somSelf,       // class object
                             MPNULL);
}

/*
 *@@ wpclsNew:
 *      overridden for debugging
 */

SOM_Scope WPObject*  SOMLINK xfobjM_wpclsNew(M_XFldObject *somSelf,
                                             PSZ pszTitle,
                                             PSZ pszSetupEnv,
                                             WPFolder* Folder,
                                             BOOL fLock)
{
    WPObject *pObject;
    /* M_XFldObjectData *somThis = M_XFldObjectGetData(somSelf); */
    // M_XFldObjectMethodDebug("M_XFldObject","xfobjM_wpclsNew");

    #ifdef DEBUG_SOMMETHODS
        _Pmpf(("xfobjM_wpclsNew, class object: %s, title: %s, setup: %s, folder: 0x%lX (%s)",
                    _somGetName(somSelf),
                    pszTitle,
                    pszSetupEnv,
                    Folder,
                    (Folder)
                        ? _wpQueryTitle(Folder)
                        : "NULL"));
    #endif

    pObject = M_XFldObject_parent_M_WPObject_wpclsNew(somSelf,
                                                    pszTitle,
                                                    pszSetupEnv,
                                                    Folder, fLock);
    #ifdef DEBUG_SOMMETHODS
        _Pmpf(("End of M_XFldObject::wpclsNew, returning pObject: 0x%lX",
                    pObject));
    #endif

    return (pObject);
}

/*
 *@@ wpclsMakeAwake:
 *      overridden for debugging
 */

SOM_Scope WPObject*  SOMLINK xfobjM_wpclsMakeAwake(M_XFldObject *somSelf,
                                                   PSZ pszTitle,
                                                   ULONG ulStyle,
                                                   HPOINTER hptrIcon,
                                                   POBJDATA pObjData,
                                                   WPFolder* Folder,
                                                   ULONG ulUser)
{
    WPObject *pObject;
    /* M_XFldObjectData *somThis = M_XFldObjectGetData(somSelf); */
    // M_XFldObjectMethodDebug("M_XFldObject","xfobjM_wpclsMakeAwake");

    #ifdef DEBUG_SOMMETHODS
        _Pmpf(("xfobjM_wpclsMakeAwake, class object: %s, title: %s, ulStyle: 0x%lX, folder: 0x%lX (%s)",
                    _somGetName(somSelf),
                    pszTitle,
                    ulStyle,
                    Folder,
                    (Folder)
                        ? _wpQueryTitle(Folder)
                        : "NULL"));

    #endif

    pObject = M_XFldObject_parent_M_WPObject_wpclsMakeAwake(somSelf,
                                                          pszTitle,
                                                          ulStyle,
                                                          hptrIcon,
                                                          pObjData,
                                                          Folder,
                                                          ulUser);
    #ifdef DEBUG_SOMMETHODS
        _Pmpf(("End of M_XFldObject::wpclsMakeAwake, returning pobject: 0x%lX",
                pObject));
    #endif

    return (pObject);
}

/*
 *@@ wpclsQuerySettingsPageSize:
 *      this WPObject class method should return the
 *      size of the largest settings page in dialog
 *      units; if a settings notebook is initially
 *      opened, i.e. no window pos has been stored
 *      yet, the WPS will use this size, to avoid
 *      truncated settings pages.
 *
 *      Since the "Object" page is pretty large,
 *      we return this.
 *
 *@@added V0.9.2 (2000-03-08) [umoeller]
 */

SOM_Scope BOOL  SOMLINK xfobjM_wpclsQuerySettingsPageSize(M_XFldObject *somSelf,
                                                          PSIZEL pSizl)
{
    /* M_XFldObjectData *somThis = M_XFldObjectGetData(somSelf); */
    M_XFldObjectMethodDebug("M_XFldObject","xfobjM_wpclsQuerySettingsPageSize");

    /* return (M_XFldObject_parent_M_WPObject_wpclsQuerySettingsPageSize(somSelf,
                                                                      pSizl)); */
    pSizl->cx = 275;       // size of "Object" page
    pSizl->cy = 150;       // size of "Object" page

    return (TRUE);
}

