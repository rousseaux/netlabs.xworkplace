<HTML WIDTH=70% XPOS=right>
<HEAD>
<TITLE>
Makefile Environment Variables
</TITLE>
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000AA" VLINK="#777777">
This section describes the environment variables which should be set
externally before executing the makefiles. These environment variables
have been introduced to allow code sharing between several projects
(mostly WarpIN) and to be able to update XWorkplace even while the
WPS is running.

<P>You can modify <CODE>MAKE.CMD</CODE> to set up these things, because
<CODE>MAKE.CMD</CODE> calls the main <CODE>makefile</CODE>.

<P>Alternatively, create your own "XWorkplace make" command file, which
sets up these variables, or define these variables in CONFIG.SYS.

<P>If these are not set, you'll either get errors from the makefiles
(certain checks are built into those), or <CODE>setup.in</CODE> will
use some dumb default, which is most probably not matching your system.

<OL><LI><CODE>CVS_WORK_ROOT</CODE> must point to the root of your CVS
working directories. The XWorkplace makefiles now (V0.9.6) assume that all
your projects (most importantly, XWorkplace and XWPHelpers)
are located in subdirectories of a single directory.
(This is useful for working with CVS in the first place, so this shouldn't
be much of a requirement in the first place.)

<P>This variable must point to the parent directory of <CODE>xworkplace</CODE>,
<CODE>xwphelpers</CODE>, <CODE>warpin</CODE>, etc. The makefiles will set
a number of other environment variables based on that variable to locate
the XWorkplace and XWPhelpers source tree bases.

<P>Example: <CODE>SET CVS_WORK_ROOT=K:\cvs</CODE>

<P>(This environment variable is required for compiling WarpIN as well, so it's
a lifetime investment.)

<P><LI><CODE>XWPRUNNING</CODE> must point to an existing XFolder/XWorkplace
installation. Since the makefiles first create all the files in <CODE>bin\</CODE>,
this is not suitable for testing your code, because XWorkplace expects a lot
of files at fixed locations relative to the directory where <CODE>XFLDR.DLL</CODE>
resides. Most makefiles will copy the target files to the directory pointed to
by this environment variable (after unlocking executables), so after rebuilding,
you can simply restart the WPS, and your new code will be running in the WPS.

<P>Do one of the following:

<UL><LI>Install the latest XWorkplace binary WarpIN archive.
Set XWPRUNNING to the same directory which you
specified as the target path to WarpIN.

<LI>Alternatively, copy the entire "release" subtree to
some new location and specify that location with
XWPRUNNING to start.

<P>This must point to the parent directory of <CODE>bin\</CODE>, <CODE>help\</CODE> etc.
in the XFolder/XWorkplace installation tree.

<P>Example: <CODE>SET XWPRUNNING=J:\Tools\XWorkplace</CODE>
</UL>

<P><LI><CODE>XWPRELEASE</CODE> is only used with <CODE>nmake release</CODE>.
This specifies the base directory where to build a complete XWorkplace release
which holds all files for a release version. That tree can then easily be "zipped"
into a WarpIN archive (.WPI).
If this directory does not exist, it is created.

<P>Even if you don't plan to use "nmake release", you
must set XWPRELEASE to something, or the makefiles
will fail.

<P>Example: <CODE>SET XWPRELEASE=dummy</CODE>

<P><LI>If <CODE>XWP_DEBUG</CODE> is defined (to anything), XWorkplace will
be compiled and linked with debug code enabled. Also, this will pass the
<CODE>__DEBUG__</CODE> define to the compiler, to which some code parts
react. For example, only if that flag is defined, PmPrintf calls will be
compiled.
<P>By contrast, if <CODE>XWP_DEBUG</CODE> is not defined, release code is produced.

<P><B>IMPORTANT NOTE:</B> If you compile the debug version,
<B>you must have the PMPRINTF DLLs somewhere on your
LIBPATH,</B> or otherwise you'll spend days figuring out why XWorkplace is
simply not working any more.
(I had this once after a reinstall
of OS/2, after which the DLLs where gone.) That is, XWorkplace classes
will not load at WPS startup, because the PMPRINTF DLL imports cannot be
resolved. Neither will registering XWorkplace classes succeed. And don't
expect to get an error message other than FALSE. <CODE>:-(</CODE>

<P>See <A HREF="src1_880debug.html">"Debugging XWorkplace"</A> for details.

<P><LI><B>Optional features.</B> Per default, a "stable" version of XWP will be built.
This excludes a number of features. If you want them to be compiled as well,
define the following environment variables:
<UL><LI><CODE>SET PAGEMAGE=YES</CODE>: include PageMage.
<LI><CODE>SET ANIMATED_MOUSE_POINTERS=YES</CODE>: include Animated Mouse Pointers.
<LI><CODE>SET REPLHANDLES=YES</CODE>: include replacement file handles management.
<LI><CODE>SET XWPSECURITY=YES</CODE>: build XWorkplace Security as well
(XWPShell and the ring-0 device driver). See
<A HREF="src2_860xwpsec.html">"XWorkplace Security"</A> for details.
</UL>These features are unstable, but they will only cause problems if they are
enabled in the "XWorkplace Setup" object or (in the case of XWorkplace Security)
if the additional executables are installed thru CONFIG.SYS.

<P><LI><B>Replacing in-use files.</B> You can rebuild XWorkplace even while the WPS is up
and XWorkplace is installed. The makefiles will automatically unlock DLLs which
are currently in use (DosReplaceModule).
After the rebuild, restart the WPS to make it use the newly
built DLLs. To do this, simply set <CODE>XWP_UNLOCK_MODULES=YES</CODE> before running
the main makefile.

<P><B>Note:</B> This environment variable has been added with V0.9.3 because with
Warp 4 FP13, unlocking WPS modules hangs the WPS after the next WPS restart. If the
environment variable is not set, modules are <I>not</I> unlocked now. So only set
the variable if you're not running Warp 4 FP13. I guess this behaviour will be the
same with Warp Server for e-business (Aurora).

<P>The exception to this are <CODE>XWPDAEMN.EXE</CODE> and <CODE>XWPHOOK.DLL</CODE>,
which are never unlocked. This is intentional.
Unlocking an executable which has registered a system hook
(which becomes part of every PM process on the system)
will _never_ release the DLL containing the hook again, so you'd have to
reboot to use the new DLL.
So if you get an error during the build process which says "XWPDAEMN.EXE is in use",
kill <CODE>XWPDAEMON.EXE</CODE> using some process killer, which will properly
unload the hooks, and try building again.

</OL>
</BODY>
</HTML>
