#
#   make\comp_standalone.in:
#
#       include file for nmake that defines the inference
#       rule for compiling class object code from C files.
#       This has been put into this include file because
#       I finally got tired of changing this rule in a
#       dozen makefiles all the time.
#
#       !include this file only for code that will be in
#       a standalone EXE file. This uses the $(CC_EXE_MT)
#       compiler setup.
#

# Define inference rules for what to do with certain file
# types, based on their file extension.
# The syntax we need here is ".fromext.toext".
# So whenever NMAKE encounters a .toext file, it
# executes what we specify here.
# The ugly {} brackets are some awkward syntax for specifying
# files in other directories.

# Special macros used here: $(@B) is the current target w/out ext.

# -- compile C files to .OBJ files, using the $(CC_EXE_MT) macro
#    defined in setup.in.
#    The output will be placed in the directory specified by
#    the OUTPUTDIR variable (set above).

.c.{$(OUTPUTDIR)}.obj:
    @echo $(MAKEDIR)\makefile [$@]: Compiling $(@B).c
!ifndef PRECH
# precompiled headers disabled:
    $(CC_EXE_MT) /Fo$(OUTPUTDIR)\$(@B).obj $(MAKEDIR)\$(@B).c
!else
    $(CC_EXE_MT) /fi"$(PRECH)\$(@B).pch" /si"$(PRECH)\$(@B).pch" /Fo$(OUTPUTDIR)\$(@B).obj $(MAKEDIR)\$(@B).c
!endif

.cpp.{$(OUTPUTDIR)}.obj:
    @echo $(MAKEDIR)\makefile [$@]: Compiling $(@B).cpp
!ifndef PRECH
# precompiled headers disabled:
    $(CC_EXE_MT) /Fo$(OUTPUTDIR)\$(@B).obj $(MAKEDIR)\$(@B).cpp
!else
    $(CC_EXE_MT) /fi"$(PRECH)\$(@B).pch" /si"$(PRECH)\$(@B).pch" /Fo$(OUTPUTDIR)\$(@B).obj $(MAKEDIR)\$(@B).cpp
!endif

